# 仪表盘内网服务使用指南

## 🚀 快速开始

### 1. 启动服务器

**macOS：**
双击运行 `start_dashboard_server.command`

**Windows：**
双击运行 `start_dashboard_server.bat`

### 2. 分享链接给员工

启动后，窗口会显示类似以下链接：
```
http://192.168.1.84:8080/客户预警仪表盘.html
```

复制这个链接发给员工（微信/飞书/邮件），他们保存为书签即可。

### 3. 每日更新流程

```bash
# 步骤1：生成最新数据
./run_customer_dashboard.command

# 步骤2：无需重启服务器！
# 员工刷新页面 (F5) 即可看到最新数据
```

---

## 💡 重要说明

### ✅ 优点
- **数据安全**：仅限局域网访问，数据不出公司
- **固定链接**：员工一次保存，永久使用
- **自动更新**：每天生成新数据后，员工刷新即可
- **零成本**：无需购买云服务

### ⚠️ 注意事项
1. **保持服务器运行**：您的电脑需要开机且运行服务器
2. **同一网络**：员工需要和您在同一局域网（公司WiFi）
3. **防火墙配置**：首次运行可能需要允许 Python 联网

---

## 🔧 故障排查

### 问题1：员工无法访问

**检查步骤：**
```bash
# 1. 确认服务器正在运行（窗口未关闭）
# 2. 确认员工在同一WiFi
# 3. 测试本机是否可访问
curl http://127.0.0.1:8080/客户预警仪表盘.html
```

**如果本机可访问，但员工不行：**
```bash
# macOS 关闭防火墙（临时测试）
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off

# 或者添加 Python 到白名单
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/bin/python3
```

### 问题2：端口被占用

**解决方案：**
```bash
# 查找占用 8080 端口的进程
lsof -i :8080

# 杀死进程（替换 <PID> 为实际进程号）
kill <PID>

# 或修改端口（编辑启动脚本中的 PORT=8080）
```

### 问题3：IP 地址变化

如果您的电脑 IP 会变化（路由器 DHCP），建议：

**方案 A：固定 IP 地址**
1. 进入路由器管理界面
2. 绑定您的 MAC 地址到固定 IP
3. 例如：绑定 `192.168.1.100`

**方案 B：使用电脑名称**
```bash
# 员工访问时使用电脑名称（无需关心 IP）
http://您的电脑名.local:8080/客户预警仪表盘.html

# 查看自己的电脑名称
hostname
```

---

## 🎯 进阶配置

### 自动启动服务（开机启动）

**macOS：**
```bash
# 创建 launchd 服务（参考 docs/macos_launchd_plist.template.xml）
cp docs/macos_launchd_plist.template.xml ~/Library/LaunchAgents/com.dashboard.server.plist

# 编辑文件，修改路径为实际路径
# 加载服务
launchctl load ~/Library/LaunchAgents/com.dashboard.server.plist
```

**Windows：**
1. Win+R 输入 `shell:startup`
2. 将 `start_dashboard_server.bat` 快捷方式放入该文件夹

### 添加访问密码（可选）

如果想增加安全性，可以使用 nginx 或 Apache 添加 HTTP Basic Auth：

```bash
# 安装 nginx
brew install nginx  # macOS
# 或 apt install nginx  # Linux

# 配置密码保护
htpasswd -c /usr/local/etc/nginx/.htpasswd 员工用户名

# 编辑 nginx.conf 添加：
# auth_basic "请输入密码";
# auth_basic_user_file /usr/local/etc/nginx/.htpasswd;
```

---

## 📊 与飞书集成

如果想让员工在飞书内直接访问：

1. 在飞书工作台创建自建应用
2. 添加"网页"能力
3. 填入仪表盘链接
4. 员工在飞书内点击即可打开

---

## 🆘 支持

如有问题，请检查：
- Python 版本：`python3 --version`（需 >= 3.6）
- 网络连接：`ping 192.168.1.84`
- 端口监听：`lsof -i :8080`

技术支持：参考 CLAUDE.md 或提交 issue
