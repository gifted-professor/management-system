# 优先分计算规则优化方案

## 【修改总览】

### 目标
筛选出**最优质**的客户，重点关注：
1. 低退货率客户（稳定可靠）
2. 高客单价客户（价值高）
3. 多订单客户（忠诚度高）
4. 长期有付费意愿的客户

---

## 【具体修改内容】

### 修改1：订单权重调整（方案A）
**修改文件**: `tech/config.json`

```json
"orders_dampening": {
  "1": 0.3,     // 保持不变（太不可靠）
  "2": 0.7,     // 60% → 70%（适度提升）
  "3": 0.9,     // 新增（3单已是前4%，接近满分）
  "default": 1.0 // 4单及以上满分
}
```

**影响**: 2单和3单客户的基础分会提升

---

### 修改2：低退货率加成（方案B）
**修改文件**: `tech/generate_customer_alerts.py`

在CLV加权部分增加退货率奖励：

```python
# 低退货率加成（在clv_boost之后）
return_rate_boost = 0
if return_rate is not None and return_rate <= 0.0:
    return_rate_boost = 20  # 零退货
elif return_rate is not None and return_rate < 0.1:
    return_rate_boost = 15  # 退货率<10%
elif return_rate is not None and return_rate < 0.2:
    return_rate_boost = 10  # 退货率10-20%
elif return_rate is not None and return_rate < 0.3:
    return_rate_boost = 5   # 退货率20-30%
elif return_rate is not None and return_rate > 0.5:
    return_rate_boost = -15  # 退货率>50%，扣分

total_boost = clv_boost + return_rate_boost
```

**影响**: 刘星辰（50%退货率）会被扣15分，低退货率客户会明显加分

---

### 修改3：高客单价加成（方案C）
**修改文件**: `tech/generate_customer_alerts.py`

增加客单价奖励：

```python
# 高客单价加成
aov_boost = 0
avg_order_value = stats.net_total / stats.orders if stats.orders else 0
if avg_order_value > 500:
    aov_boost = 25
elif avg_order_value > 400:
    aov_boost = 15
elif avg_order_value > 300:
    aov_boost = 10
elif avg_order_value > 200:
    aov_boost = 5

total_boost = clv_boost + return_rate_boost + aov_boost
```

**影响**: 635个高客单价低订单客户会大幅提升

---

### 修改4：订单数加成优化（方案D）
**修改文件**: `tech/generate_customer_alerts.py`

优化现有的订单数加成：

```python
# CLV加权：给高CLV客户额外加分
clv_boost = 0
if potential_label == "明星客户":
    clv_boost = 30  # 保持不变
elif potential_label == "潜力客户":
    clv_boost = 15  # 保持不变
elif stats.orders >= 10:
    clv_boost = 40  # 20 → 40（10单太稀缺了）
elif stats.orders >= 7:
    clv_boost = 30  # 新增
elif stats.orders >= 5:
    clv_boost = 20  # 10 → 20
elif stats.orders >= 4:
    clv_boost = 10  # 新增
elif stats.orders >= 3:
    clv_boost = 5   # 新增（3单就是前4%）
```

**影响**: 多订单客户加分更明显

---

### 修改5：Uplift上限条件放宽（方案E）
**修改文件**: `tech/config.json` 和 `tech/generate_customer_alerts.py`

#### 5.1 配置文件增加条件Uplift上限
```json
"defaults": {
  "uplift_ceiling": 2.0,           // 默认上限
  "uplift_ceiling_premium": 3.5,   // 优质客户上限（新增）
  "uplift_premium_min_orders": 3,  // 最少订单数（新增）
  "uplift_premium_max_return": 0.3, // 最高退货率（新增）
  "uplift_premium_min_days_span": 30 // 最小时间跨度（新增）
}
```

#### 5.2 代码逻辑修改
```python
# 判断是否为优质客户，使用更高的Uplift上限
uplift_ceiling = config_model.defaults.get("uplift_ceiling", 2.0)

# 优质客户条件判断
if stats.orders >= 3 and return_rate is not None and return_rate < 0.3:
    # 检查时间跨度（首单到末单）
    if stats.first_order and last_order:
        days_span = (last_order - stats.first_order).days
        if days_span >= 30:
            # 满足条件，使用更高上限
            uplift_ceiling = config_model.defaults.get("uplift_ceiling_premium", 3.5)

# 使用动态上限计算uplift
estimated_uplift = max(floor, min(uplift_ceiling, base + max(0.0, ratio - 1.0)))
```

**影响**: 优质老客户在濒临流失时能获得更高的紧迫性评分

---

## 【修改后的完整公式】

```
优先分 = 
  [(估算Uplift × 估算毛利 × (1 - 估算退货率)) - 触达成本] 
  × 订单权重 
  + 订单数加成 
  + 低退货率加成 
  + 高客单价加成
```

---

## 【预期效果】

### 得分提升的客户类型：
1. ✅ **低退货高客单价客户** - 大幅提升
   - 示例：3单、客单价450元、0退货 → +5+15+15 = +35分
   
2. ✅ **多订单忠诚客户** - 显著提升
   - 示例：7单客户 → +30分（原来只有+10分）

3. ✅ **优质濒临流失客户** - 紧迫性提升
   - 示例：5单、低退货、200天未购 → Uplift上限3.5（原来2.0）

### 得分下降的客户类型：
1. ❌ **高退货率客户** - 明显下降
   - 示例：退货率>50% → -15分
   - 刘星辰就属于这类

2. ❌ **低客单价客户** - 相对下降
   - 示例：客单价150元 → 0加分，被其他人拉开差距

---

## 【实施步骤】

1. ✅ 修改 `tech/config.json`
2. ✅ 修改 `tech/generate_customer_alerts.py`
3. ✅ 重新生成数据
4. ✅ 对比新旧TOP 100客户
5. ✅ 验证效果

---

## 【风险提示】

1. **待跟进人数可能减少** - 因为筛选更严格了
2. **排名会大洗牌** - 高退货率客户会明显下降
3. **需要观察实际跟进效果** - 建议运行1-2周后评估

---

**准备好开始修改了吗？**
